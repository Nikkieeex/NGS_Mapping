---
title: "logboek_ngs"
output: html_document
date: "2025-09-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Sample4_0394321_L001_R1_001.fastq, 646,109 KB
Sample4_0394321_L001_R2_001.fastq, 646,117 KB

op galaxy de data sets in een collection gezet


## FASTQC

Deze test doen we op de ruwe data. Later gaan we deze opnieuw doen om te kijken wat voor invloed de andere testen hebben gehad.
Uit de report kwam dan 1 test is gefaald en twee testen een warning hebben

HTML-rapport:

![PerBaseSequenceContent](/homes/nfbovenga/NGS_Mapping/Images/PerBaseSequenceContent.png)
Per base sequence content faalde omdat:
De basensamenstelling is niet stabiel en de lijnen voor A, T, G en C lopen niet parallel. Vooral bij de eerste ~10 basen en de laatste basen is er sterke afwijking tussen de nucleotiden. Dit kan komen door library-prep bias (bijvoorbeeld tagmentatie of primerbias), of door adapters/contaminatie. Bij RNA-Seq wordt dit vaak gezien en is het minder problematisch, bij DNA-Seq kan het duiden op adapters of bias die nog weggefilterd moet worden.


![SequenceLegthDistribution](/homes/nfbovenga/NGS_Mapping/Images/SequenceLegthDistribution.png)
Sequence Length Distribution kreeg een warning omdat:
De grafiek laat zien dat bijna alle reads dezelfde lengte hebben (~150 bp). Dit is normaal voor Illumina paired-end sequencing (NextSeq/MiSeq), waar reads een vaste lengte hebben. De kleine variatie aan het einde zorgt voor een waarschuwing, maar dit is geen probleem voor downstream analyse.


![SequenceDuplicationLevels](/homes/nfbovenga/NGS_Mapping/Images/SequenceDuplicationLevels.png)

Sequence Duplication Levels kreeg een warning omdat:
De curve laat zien dat de meerderheid van de reads uniek is (links hoog), en dat het aantal duplicaten snel afneemt. Toch blijft na deduplicatie maar ~60% unieke reads over (dus ~40% duplicaten). Dit verklaart de waarschuwing. Voor RNA-Seq-data is dit normaal, omdat sterk tot expressie komende genen vaker worden gesequenced en zo duplicaten veroorzaken. Voor DNA-Seq kan het wijzen op PCR-duplicatie of coverage bias.

Beschreven met behulp van https://www.bioinformatics.babraham.ac.uk/projects/fastqc/Help


## Trimmen (Trimmomatic)

Instellingen:
ILLUMINACLIP: standaard Illumina adapters (met adapterbestand geselecteerd)
LEADING: 20
TRAILING: 20
SLIDINGWINDOW: 4:20
MINLEN: 70
Input: Paired-end FASTQ (R1 en R2)
Output: Paired-end trimmed FASTQâ€™s en bijbehorende unpaired bestanden


## MultiQC

Ik heb nog een keer FASTQC uitgevoerd na het trimmen. Ik zag nogsteeds 1 fail en 2 warnings. MultiQC heb ik daarna uitgevoerd om de verschillen te zien. In de afbeelding hieronder in figuur 1 zie je de status.

![figuur_1](/homes/nfbovenga/NGS_Mapping/Images/MultiQC1.png)
![figuur_2](/homes/nfbovenga/NGS_Mapping/Images/PerSequenceQualityScores.png)

Per Sequence Quality Scores (figuur 2):
De meeste reads hebben een hoge gemiddelde kwaliteitsscore (>30), wat wijst op betrouwbare data. Er is nauwelijks een piek in de lage kwaliteitszones (<20), dus er zijn geen grote problemen met slechte reads. Dit bevestigt dat de dataset na trimming over het algemeen van goede kwaliteit is.
Nu kan mapping beginnen!


## Mapping with reference genonome

Standaard mens genoom gebruikt (h38)


## Sortsam tool

Instellingen:
Input is vorige SAM/BAM file
Sort order: coordinate
Validation stringency: LENIENT


## MarkDuplicates

Instellinegn:
Input: gesorteerde BAM van vorige stap
f true do not write duplicates to the output file instead of writing them with appropriate flags set, Yes
Assume the input file is already sorted, Yes
The scoring strategy op SUM_OF_BASE_QUALITIES
The maximum offset: 100
Select validation stringency: Lenient


## Variant Calling

Goed opletten met reference genoom kiezen, want hij staat standaard op h19.

Instellingen:
Input: MarkDuplicates output (BAM)
Using reference genome: h38
Limit variant calling to a set of regions: Do not limit
Read coverage: Use defaults 
Choose parameter selection level: Simple diploid calling
Type of main output to produce: VCF (default)

## VCFilter

instellingen:
Input: VCF bestand
Specify filtering value: DP> 20
Filter entire records, not just alleles: No
Tag VCF records as positively filtered: No
Tag VCF records as negatively filtered: No
Append the existing filter tag: No
Apply tag-pass on a per-allele basis: No
Invert the filter: No
Use logical OR instead of AND to combine filters: No


## Annotatie met SnpEff

Input: gefilterde VCF van vorige stap 

Bij genoom dowload on demand gekozen en GRCh38.86 ingevult 

##10-10-2025
Vandaag ga ik verder met de bovenstaande stap annotie met SNpEff

```{bash}
java -jar /data/datasets/dbNSFP/snpEff/SnpSift.jar DbNsfp -db /data/datasets/dbNSFP/snpEff/data/dbNSFP4.3c.txt.gz ~/Desktop/variant_step2.vcf > ~/Desktop/variants_step3.vcf
```

| Field ID                  | Source Database     | Value Type / Description                                      |
|---------------------------|---------------------|---------------------------------------------------------------|
| DP                        | LoFreq              | Integer: Raw read depth                                       |
| AF                        | LoFreq              | Float: Allele frequency                                       |
| SB                        | LoFreq              | Integer: Strand bias (Phred-scaled)                           |
| DP4                       | LoFreq              | Integer[4]: Ref/alt forward/reverse base counts               |
| INDEL                     | LoFreq              | Flag: Indicates INDEL variant                                 |
| CONSVAR                   | LoFreq              | Flag: Consensus variant indicator                             |
| HRUN                      | LoFreq              | Integer: Homopolymer run length                               |
| ANN                       | SnpEff              | String: Functional annotation (gene, impact, consequence, etc.) |
| LOF                       | SnpEff              | String: Predicted loss-of-function annotation                 |
| NMD                       | SnpEff              | String: Nonsense-mediated decay prediction                    |
| DBVARID                   | dbVar               | String: Structural variant accession ID                       |
| MC                        | dbSNP / ClinVar     | String: Molecular consequence (SO terms)                      |
| CLNDN                     | ClinVar             | String: Disease name                                          |
| ALLELEID                  | ClinVar             | Integer: Allele ID                                            |
| CLNVC                     | ClinVar             | String: Variant type                                          |
| CLNSIG                    | ClinVar             | String: Clinical significance                                 |
| CLNVCSO                   | ClinVar             | String: Sequence Ontology ID                                  |
| CLNVI                     | ClinVar             | String: Source database and variant ID                        |
| CLNREVSTAT               | ClinVar             | String: Review status                                         |
| CLNSIGINCL                | ClinVar             | String: Clinical significance for haplotype/genotype          |
| RS                        | dbSNP               | String: rsID (SNP identifier)                                 |
| CLNDISDB                  | ClinVar             | String: Disease database and identifier                       |
| GENEINFO                  | ClinVar             | String: Gene symbol and ID                                    |
| AF_EXAC / AF_ESP / AF_TGP | ExAC / ESP / TGP    | Float: Population allele frequencies                          |
| ORIGIN                    | ClinVar             | String: Allele origin codes                                   |
| CLNSIGCONF                | ClinVar             | String: Conflicting clinical significance                     |
| CLNHGVS                   | ClinVar             | String: HGVS expression                                       |
| dbNSFP_*                  | dbNSFP              | Various: Predictive scores, allele counts, conservation, etc. |

